# Build
FROM golang:1.24.2-alpine AS builder
ARG app
WORKDIR /build
COPY . .
RUN echo building app : ${app}
RUN go -C cmd/web/${app} build -o main 
# Alpine Linux 
FROM alpine:latest
ARG app
RUN addgroup -S tarantula && adduser -S tarantula -G tarantula
RUN mkdir /etc/tarantula 
COPY cmd/web/${app}/${app}-conf.json /etc/tarantula/${app}-conf.json
RUN mkdir /home/tarantula/${app}
RUN chown -R tarantula /home/tarantula/${app}
VOLUME /home/tarantula/${app}

# Application Install 
USER tarantula
WORKDIR /home/tarantula/bin

COPY --from=builder /build/cmd/web/${app}/main .
ARG h
ARG n
ARG i
#EXPOSE 8080
#EXPOSE 5000
ENV TN_HOST=${h}
ENV TN_NAME=${n}
ENV TN_ID=${i}
ENTRYPOINT ["./main"]