# Build
FROM golang:1.24.2-alpine AS builder
ARG app
WORKDIR /build
COPY . .
RUN echo building app : ${app}
RUN go -C cmd/web/${app} build -o main 
# Alpine Linux 
FROM alpine:latest

RUN addgroup -S tarantula && adduser -S tarantula -G tarantula
RUN mkdir /etc/tarantula 
COPY cmd/web/presence/presence-conf.json /etc/tarantula/presence-conf.json
RUN mkdir /home/tarantula/presence
RUN chown -R tarantula /home/tarantula/presence
VOLUME /home/tarantula/presence

# Application Install 
USER tarantula
WORKDIR /home/tarantula/bin

COPY --from=builder /build/cmd/web/presence/main .
ARG cfg
EXPOSE 8080
EXPOSE 5000
ENV TARANTULA_NODE_CONFIG=${cfg}
ENTRYPOINT ["./main"]