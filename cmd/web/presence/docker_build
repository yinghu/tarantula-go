# Build
FROM golang:1.24.2-alpine AS builder

WORKDIR /build
COPY . .
RUN go -C cmd/web/presence build -o main 

# Alpine Linux 
FROM alpine:latest

RUN addgroup -S tarantula && adduser -S tarantula -G tarantula
RUN mkdir /etc/tarantula 
COPY cmd/web/presence/presence-conf.json /etc/tarantula/presence-conf.json
RUN mkdir /home/tarantula/presence
RUN chown -R tarantula /home/tarantula/presence
VOLUME /home/tarantula/presence

# Application Install 
USER tarantula
WORKDIR /home/tarantula/bin

COPY --from=builder /build/cmd/web/presence/main .

EXPOSE 8080
EXPOSE 5000
ENV TARANTULA_NODE_NAME=a01
ENV TARANTULA_NODE_ID=1
ENTRYPOINT ["./main"]