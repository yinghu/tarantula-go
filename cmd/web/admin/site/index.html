<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css"/>
    <link rel="stylesheet" href="tarantula.admin.css"/>
    <script src="tarantula.admin.js"></script>
    <script src="tarantula.html.js"></script>
    <title>iCodeSoftware</title>
    </head>
    <body>
        <div class="w3-display-container w3-teal w3-border-bottom w3-border-red tx-content-120">
            <div class="w3-display-topleft w3-padding">
                <span><i class="material-symbols-outlined tx-margin-left-8 tx-orange-icon-48">widgets</i></span>
            </div>
            <div class="w3-display-topright w3-padding">
                <span id="tx-logout" style="display: none;"><i class="material-symbols-outlined tx-margin-left-8 tx-orange-icon-32">logout</i></span>
            </div>
            <div class="w3-display-bottomleft w3-padding">
               <span class="tx-margin-left-8 tx-text-32">Tarantula Web Admin Tool</span>             
            </div>
            <div class="w3-display-bottomright w3-padding">
               <span class="tx-margin-right-8 tx-text-16">Powered By iCodeSoftware LLC</span>             
            </div>
        </div>
        <div class="w3-flex">
            <div id="tx-task-list" class="w3-padding w3-teal" style="flex-basis:20%;">
            </div>
            <div class="w3-padding w3-white" style="flex-basis:80%;">
                <div id="tx-info-box" class="w3-display-container w3-border w3-border-red tx-content-48" style="display: none;">
                    <div class="w3-display-topleft w3-padding">
                        <span><i class="material-symbols-outlined tx-margin-left-8 tx-orange-icon-32">report</i></span>
                    </div>
                    <div class="w3-display-topright w3-padding">
                        <span id="tx-info-box-close"><i class="material-symbols-outlined tx-margin-left-8 tx-red-icon-24">close</i></span>
                    </div>
                    <div id="tx-info-box-content" class="w3-display-middle w3-padding tx-text-12 w3-text-red"></div>
                </div>
                <div id="tx-job-list-box" class="w3-bar w3-border-bottom w3-border-teal tx-margin-top-4" style="display: none"></div> 
                <div id="tx-form-box" class="w3-container tx-margin-top-8" style="display: none"></div>
                <div id="tx-category-list-box" class="w3-bar w3-border-bottom w3-border-teal tx-margin-top-8" style="display: none">
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-category-opt">HomingAgent</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-category-opt">Configuration</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-category-opt">Metrics</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-category-opt">Management</span> 
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-category-opt">HomingAgent</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-category-opt">Configuration</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-category-opt">Metrics</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">Management</span>        
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">HomingAgent</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">Configuration</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">Metrics</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">Management</span>        
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">HomingAgent</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">Configuration</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">Metrics</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">Management</span>               
                </div>
                <div id="tx-instance-list-box" class="w3-bar w3-border-bottom w3-border-teal tx-margin-top-8" style="display: none">
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-category-opt">HomingAgent</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-category-opt">Configuration</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-category-opt">Metrics</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-category-opt">Management</span> 
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-category-opt">HomingAgent</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-category-opt">Configuration</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-category-opt">Metrics</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">Management</span>        
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">HomingAgent</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">Configuration</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">Metrics</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">Management</span>        
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">HomingAgent</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">Configuration</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">Metrics</span>
                     <span class="w3-bar-item w3-green w3-tag tx-text-20 tx-padding-button tx-margin-right-4 tx-margin-bottom-4 tx-opt">Management</span>         
                </div>    
            </div>
        </div>
        <script>
            Html.eventWithId('#tx-info-box-close',()=>{Html.closeWithId('#tx-info-box');});
            if (!Admin.query().authenticated){
                on_logout();
            }
           
            Html.eventWithId('#tx-logout',()=>{
                Admin.logout();
                Html.closeWithId("#tx-info-box");
                Html.closeWithId("#tx-logout");
                Html.openWithId("#tx-form-box"); 
                Html.messageWithId("#tx-task-list","");
                Html.closeWithId("#tx-job-list-box");
                Html.closeWithId("#tx-category-list-box");
                Html.closeWithId("#tx-instance-list-box");   
                on_logout();
            });

            function on_logout(){
                Admin.getJson("/admin/web/login.json",resp=>{
                    Html.form("#tx-form-box","login",resp,false,(data)=>{
                        console.log(data);
                        Admin.postJson("/admin/login",data,(resp)=>{
                            console.log(resp)
                            if(!resp.successful){
                                Html.messageWithId("#tx-info-box-content",resp.message);    
                                Html.openWithId("#tx-info-box");
                                return;
                            }
                            Html.registerTaskChangeListener(on_task_change);
                            on_login(resp);
                            Html.closeWithId("#tx-info-box");
                            Html.openWithId("#tx-logout");
                            Html.openWithId("#tx-job-list-box");
                            Html.openWithId("#tx-category-list-box");
                            Html.openWithId("#tx-instance-list-box");
                            Html.closeWithId("#tx-form-box");
                        });
                    });
                    Html.openWithId("#tx-form-box");
                });
            }

            function on_login(auth){
                Admin.login(auth);
                Admin.getJson("/admin/webprotected/task.bar.json",(resp)=>{
                    Html.taskList("#tx-task-list","task",resp,(a)=>{
                        Html.jobList("#tx-job-list-box","job",a,(b)=>{
                            eval(b+"()");
                        });        
                    });
                    Html.jobList("#tx-job-list-box","job","Asset",(b)=>{
                        eval(b+"()");
                    });
                });
            }

            function create_new_enum(){
                Html.enumForm("#tx-form-box",(data)=>{
                    let valid = {Name:data.Name,Values:[]};
                    for( let i=0;i<data.ix;i++){
                        if("entry"+i in data){
                            let ev = data["entry"+i];
                            valid.Values.push(ev);
                        }    
                    }
                    console.log(valid);
                    Admin.postJson("/admin/saveenum",valid,resp=>{
                        console.log(resp);
                        Html.messageWithId("#tx-info-box-content",resp.message);    
                        Html.openWithId("#tx-info-box");
                    });
                });
                Html.openWithId("#tx-form-box");
            }

            function create_new_category(){
                Admin.getJson("/admin/webprotected/category.json",(resp)=>{
                    Html.categoryForm("#tx-form-box",resp,(data)=>{
                        let valid ={Name:data.Name,Description:data.Description,Scope:data.Scope,Properties:[]};
                        for( let i=0;i<data.ix;i++){
                            if("c-entry"+i in data){
                                let ev = data["c-entry"+i];
                                valid.Properties.push(ev);
                            }    
                        }
                        console.log(valid);
                        Admin.postJson("/admin/savecategory",valid,resp=>{
                            console.log(resp);
                            Html.messageWithId("#tx-info-box-content",resp.message);    
                            Html.openWithId("#tx-info-box");
                        });
                    });
                    Html.openWithId("#tx-form-box"); 
                });   
            }
            function on_task_change(tn){
                Admin.getJson("/admin/loadcategories/"+tn,resp=>{
                    Html.categoryList("#tx-category-list-box","cc",resp,cid=>{
                        console.log(cid)
                    });    
                });
            }
        </script>
    </body>
</html>